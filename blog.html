<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>News & Updates | Battalla TCG</title>
  <link rel="icon" type="image/x-icon" href="https://battalla.com/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Fondamento&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Fondamento', cursive;
      background: #000;
      color: #2c2416;
      line-height: 1.7;
      letter-spacing: 0.3px;
    }
    header {
      background: #c9b896;
      padding: 1rem 0;
      text-align: center;
      border-bottom: 3px solid #8b7355;
    }
    .logo-header {
      max-width: 300px;
      width: 80%;
      height: auto;
      margin: 0 auto 1rem;
      cursor: pointer;
    }
    nav {
      background: #c9b896;
      padding: 0.5rem 0;
    }
    .nav-links {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 2rem;
      list-style: none;
      padding: 0 1rem;
    }
    .nav-links a {
      color: #2c2416;
      text-decoration: none;
      font-size: 1.3rem;
      font-weight: 700;
      text-transform: uppercase;
      transition: color 0.3s;
      letter-spacing: 1px;
      padding: 0.3rem 0.5rem;
    }
    .nav-links a:hover { color: #8b6914; }
    .nav-links .active {
      color: #8b6914;
      font-weight: bold;
      text-decoration: underline #8b6914 2px;
    }
    .content-section {
      background: #c9b896;
      min-height: 100vh;
      padding: 2rem;
    }
    .content-container {
      max-width: 1000px;
      margin: 0 auto;
    }
    .page-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      color: #8b6914;
      text-align: center;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .admin-toggle {
      text-align: center;
      margin-bottom: 2rem;
    }
    .admin-btn {
      background: #8b6914;
      color: #fff;
      border: none;
      padding: 0.8rem 2rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
      font-family: 'Fondamento', cursive;
      text-transform: uppercase;
    }
    .admin-btn:hover {
      background: #2c2416;
      transform: translateY(-2px);
    }
    .admin-panel {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      border: 3px solid #8b7355;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .admin-panel.active { display: block; }
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-group label {
      display: block;
      font-weight: bold;
      color: #8b6914;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid #8b7355;
      border-radius: 5px;
      font-family: 'Fondamento', cursive;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.8);
    }
    .form-group textarea {
      min-height: 150px;
      resize: vertical;
    }
    .form-group small {
      display: block;
      margin-top: 0.3rem;
      color: #8b7355;
      font-size: 0.9rem;
    }
    .image-preview-container {
      margin-top: 1rem;
      display: none;
    }
    .image-preview-container.active {
      display: block;
    }
    .image-preview {
      max-width: 100%;
      max-height: 300px;
      border-radius: 10px;
      border: 2px solid #8b7355;
      margin-top: 0.5rem;
    }
    .formatting-toolbar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
    }
    .toolbar-btn {
      background: #8b7355;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Fondamento', cursive;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    .toolbar-btn:hover {
      background: #8b6914;
    }
    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .submit-btn, .cancel-btn, .export-btn {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      font-family: 'Fondamento', cursive;
      text-transform: uppercase;
      transition: all 0.3s;
    }
    .submit-btn {
      background: #8b6914;
      color: #fff;
    }
    .submit-btn:hover {
      background: #2c2416;
    }
    .cancel-btn {
      background: #8b7355;
      color: #fff;
    }
    .cancel-btn:hover {
      background: #2c2416;
    }
    .export-btn {
      background: #27ae60;
      color: #fff;
    }
    .export-btn:hover {
      background: #1e8449;
    }
    .blog-posts {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .blog-post {
      background: rgba(255, 255, 255, 0.9);
      border: 3px solid #8b7355;
      border-radius: 15px;
      padding: 2rem;
      transition: all 0.3s;
    }
    .blog-post:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    .post-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .post-title {
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      color: #8b6914;
      margin-bottom: 0.5rem;
      flex: 1;
    }
    .post-category {
      display: inline-block;
      background: #8b6914;
      color: #fff;
      padding: 0.3rem 0.8rem;
      border-radius: 5px;
      font-size: 0.9rem;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }
    .post-date {
      font-size: 1rem;
      color: #8b7355;
      font-style: italic;
    }
    .post-image {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #8b7355;
      margin: 1rem 0;
    }
    .post-content {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #2c2416;
      word-wrap: break-word;
    }
    .post-content h3 {
      color: #8b6914;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      font-size: 1.5rem;
    }
    .post-content p {
      margin-bottom: 1rem;
    }
    .post-content ul, .post-content ol {
      margin-left: 2rem;
      margin-bottom: 1rem;
    }
    .post-content li {
      margin-bottom: 0.5rem;
    }
    .post-content a {
      color: #8b6914;
      text-decoration: underline;
      transition: color 0.3s;
    }
    .post-content a:hover {
      color: #2c2416;
    }
    .post-content strong {
      font-weight: bold;
      color: #8b6914;
    }
    .post-content em {
      font-style: italic;
    }
    .post-content img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      margin: 1rem 0;
      border: 2px solid #8b7355;
    }
    .post-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .edit-btn, .delete-btn {
      padding: 0.6rem 1.5rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Fondamento', cursive;
      font-weight: 600;
      transition: all 0.3s;
    }
    .edit-btn {
      background: #8b6914;
      color: #fff;
    }
    .edit-btn:hover {
      background: #2c2416;
    }
    .delete-btn {
      background: #c0392b;
      color: #fff;
    }
    .delete-btn:hover {
      background: #7f2417;
    }
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      background: rgba(255, 255, 255, 0.8);
      border: 3px solid #8b7355;
      border-radius: 15px;
    }
    .empty-state p {
      font-size: 1.3rem;
      color: #8b6914;
    }
    .loading {
      text-align: center;
      padding: 2rem;
      font-size: 1.3rem;
      color: #8b6914;
    }
    .help-box {
      background: rgba(139, 105, 20, 0.1);
      border: 2px solid #8b6914;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    .help-box h4 {
      color: #8b6914;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .help-box ul {
      margin-left: 1.5rem;
    }
    .help-box li {
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    .export-notice {
      background: rgba(39, 174, 96, 0.1);
      border: 2px solid #27ae60;
      border-radius: 10px;
      padding: 1rem;
      margin-top: 1rem;
    }
    .export-notice p {
      color: #27ae60;
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }
    .export-notice code {
      background: rgba(0,0,0,0.1);
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-family: monospace;
    }
    footer {
      background: #c9b896;
      padding: 2rem 1rem;
      text-align: center;
      border-top: 3px solid #8b7355;
    }
    footer h2 {
      font-size: clamp(1.3rem, 4vw, 2rem);
      color: #2c2416;
      margin-bottom: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .social-icons {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    .social-icons a {
      color: #2c2416;
      transition: color 0.3s, transform 0.2s;
      text-decoration: none;
    }
    .social-icons a:hover {
      color: #8b6914;
      transform: scale(1.1);
    }
    .social-icons svg {
      width: clamp(32px, 5vw, 40px);
      height: clamp(32px, 5vw, 40px);
    }
    @media (max-width: 768px) {
      .content-container { padding: 1rem; }
      .blog-post { padding: 1.5rem; }
      .post-actions { flex-direction: column; }
      .form-actions { flex-direction: column; }
      .formatting-toolbar { gap: 0.3rem; }
      .toolbar-btn { padding: 0.4rem 0.7rem; font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <header>
    <img src="./images/dc117f_a88498c6731148b3bfe48d80f65957bd_mv2.avif" alt="Battalla!" class="logo-header" onclick="window.location.href='index.html'" />
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">HOME</a></li>
        <li><a href="about.html">About Us</a></li>
        <li><a href="cards.html">Cards</a></li>
        <li><a href="deck-builder.html">Deck Builder</a></li>
        <li><a href="how-to-play.html">How to Play</a></li>
        <li><a href="rulings.html">Rulings</a></li>
        <li><a href="blog.html" class="active">News</a></li>
      </ul>
    </nav>
  </header>

  <section class="content-section">
    <div class="content-container">
      <h1 class="page-title">News & Updates</h1>
      
      <div class="admin-toggle">
        <button class="admin-btn" onclick="toggleAdmin()">Admin Panel</button>
      </div>

      <div class="admin-panel" id="adminPanel">
        <h2 style="color: #8b6914; margin-bottom: 1.5rem; font-size: 2rem;">Create/Edit Post</h2>
        
        <div class="help-box">
          <h4>Formatting Tips:</h4>
          <ul>
            <li>Use toolbar buttons or type Markdown syntax directly</li>
            <li>**bold text** for bold, *italic text* for italic</li>
            <li>[Link Text](url) for links</li>
            <li>![Alt Text](image-url) for inline images</li>
            <li>### for headings</li>
            <li>- or * for bullet points</li>
          </ul>
        </div>

        <form id="postForm" onsubmit="handleSubmit(event)">
          <input type="hidden" id="postId" />
          
          <div class="form-group">
            <label for="postTitle">Title *</label>
            <input type="text" id="postTitle" required placeholder="Enter post title..." />
          </div>

          <div class="form-group">
            <label for="postCategory">Category</label>
            <select id="postCategory">
              <option value="">General</option>
              <option value="announcement">Announcement</option>
              <option value="tournament">Tournament</option>
              <option value="new-cards">New Cards</option>
              <option value="rules">Rules Update</option>
              <option value="community">Community</option>
            </select>
          </div>

          <div class="form-group">
            <label for="postImageUrl">Featured Image URL (optional)</label>
            <input type="url" id="postImageUrl" placeholder="https://example.com/image.jpg" oninput="previewImage()" />
            <small>Paste a URL to an image (from your /images folder, Imgur, etc.)</small>
            <div id="imagePreviewContainer" class="image-preview-container">
              <img id="imagePreview" class="image-preview" alt="Preview" />
            </div>
          </div>
          
          <div class="form-group">
            <label for="postContent">Content *</label>
            <div class="formatting-toolbar">
              <button type="button" class="toolbar-btn" onclick="insertMarkdown('**', '**')">Bold</button>
              <button type="button" class="toolbar-btn" onclick="insertMarkdown('*', '*')">Italic</button>
              <button type="button" class="toolbar-btn" onclick="insertMarkdown('### ', '')">Heading</button>
              <button type="button" class="toolbar-btn" onclick="insertMarkdown('[', '](url)')">Link</button>
              <button type="button" class="toolbar-btn" onclick="insertMarkdown('![', '](image-url)')">Image</button>
              <button type="button" class="toolbar-btn" onclick="insertMarkdown('- ', '')">Bullet</button>
            </div>
            <textarea id="postContent" required placeholder="Write your post content here... Use Markdown for formatting!"></textarea>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="submit-btn">Publish Post</button>
            <button type="button" class="export-btn" onclick="exportPosts()">Export to JSON</button>
            <button type="button" class="cancel-btn" onclick="cancelEdit()">Cancel</button>
          </div>
        </form>

        <div class="export-notice">
          <p><strong>ðŸ’¡ Tip for GitHub Pages:</strong></p>
          <p>After creating posts, click "Export to JSON" to download <code>blog-posts.json</code></p>
          <p>Add this file to your repository so posts appear for all visitors!</p>
        </div>
      </div>

      <div id="postsContainer" class="loading">
        Loading posts...
      </div>
    </div>
  </section>

  <footer>
    <h2>Follow Our Socials!</h2>
    <div class="social-icons">
      <a href="https://discord.gg/hMYNUJnmy7" aria-label="Discord" title="Discord">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
        </svg>
      </a>
      <a href="https://www.instagram.com/battallatcg/" aria-label="Instagram" title="Instagram">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2.163c3.204 0 3.584.012 4.85.07c3.252.148 4.771 1.691 4.919 4.919c.058 1.265.069 1.645.069 4.849c0 3.205-.012 3.584-.069 4.849c-.149 3.225-1.664 4.771-4.919 4.919c-1.266.058-1.644.07-4.85.07c-3.204 0-3.584-.012-4.849-.07c-3.26-.149-4.771-1.699-4.919-4.92c-.058-1.265-.07-1.644-.07-4.849c0-3.204.013-3.583.07-4.849c.149-3.227 1.664-4.771 4.919-4.919c1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072C2.695.272.273 2.69.073 7.052C.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98c.059-1.28.073-1.689.073-4.948c0-3.259-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324a6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8a4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881a1.44 1.44 0 0 0 0-2.881z"/>
        </svg>
      </a>
      <a href="https://www.facebook.com/profile.php?id=100076065249023" aria-label="Facebook" title="Facebook">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
          <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669c1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
        </svg>
      </a>
    </div>
  </footer>

  <script>
    let editingPostId = null;

    // Try to load posts from JSON file, fallback to localStorage
    async function loadPostsFromJSON() {
      try {
        const response = await fetch('./blog-posts.json');
        if (response.ok) {
          const posts = await response.json();
          return posts;
        }
      } catch (err) {
        console.log('No blog-posts.json found, using localStorage');
      }
      return null;
    }

    function getPostsFromLocalStorage() {
      const postsJSON = localStorage.getItem('battalla_blog_posts');
      if (postsJSON) {
        try {
          return JSON.parse(postsJSON);
        } catch (err) {
          console.error('Error parsing localStorage:', err);
        }
      }
      return [];
    }

    function savePostsToLocalStorage(posts) {
      localStorage.setItem('battalla_blog_posts', JSON.stringify(posts));
    }

    function toggleAdmin() {
      const panel = document.getElementById('adminPanel');
      panel.classList.toggle('active');
      if (!panel.classList.contains('active')) {
        cancelEdit();
      }
    }

    function previewImage() {
      const url = document.getElementById('postImageUrl').value.trim();
      const container = document.getElementById('imagePreviewContainer');
      const preview = document.getElementById('imagePreview');
      
      if (url) {
        preview.src = url;
        preview.onerror = () => {
          container.classList.remove('active');
        };
        preview.onload = () => {
          container.classList.add('active');
        };
      } else {
        container.classList.remove('active');
      }
    }

    function insertMarkdown(before, after) {
      const textarea = document.getElementById('postContent');
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      const newText = before + selectedText + after;
      
      textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
      
      const newCursorPos = start + before.length + selectedText.length;
      textarea.focus();
      textarea.setSelectionRange(newCursorPos, newCursorPos);
    }

    function parseMarkdown(text) {
      let html = text;
      
      // Parse images first (before links, since they have similar syntax)
      html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; border-radius: 10px; margin: 1rem 0; border: 2px solid #8b7355;" />');
      
      html = html.replace(/### (.+)/g, '<h3>$1</h3>');
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
      html = html.replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
      
      const lines = html.split('\n');
      let result = [];
      let inList = false;
      
      for (let line of lines) {
        if (line.trim().startsWith('- ') || line.trim().startsWith('* ')) {
          if (!inList) {
            result.push('<ul>');
            inList = true;
          }
          result.push('<li>' + line.trim().substring(2) + '</li>');
        } else {
          if (inList) {
            result.push('</ul>');
            inList = false;
          }
          if (line.trim() && !line.trim().startsWith('<h3>')) {
            result.push('<p>' + line + '</p>');
          } else {
            result.push(line);
          }
        }
      }
      
      if (inList) {
        result.push('</ul>');
      }
      
      return result.join('\n');
    }

    async function loadPosts() {
      const container = document.getElementById('postsContainer');
      
      try {
        // Try JSON file first
        let posts = await loadPostsFromJSON();
        
        // Fallback to localStorage
        if (!posts) {
          posts = getPostsFromLocalStorage();
        }
        
        if (!posts || posts.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No posts yet. Check back soon for updates!</p></div>';
          return;
        }

        posts.sort((a, b) => b.timestamp - a.timestamp);

        container.innerHTML = '<div class="blog-posts">' + posts.map(post => {
          const categoryLabel = post.category ? `<span class="post-category">${escapeHtml(post.category)}</span>` : '';
          const imageHtml = post.imageUrl ? `<img src="${escapeHtml(post.imageUrl)}" alt="${escapeHtml(post.title)}" class="post-image" onerror="this.style.display='none'" />` : '';
          
          return `
            <article class="blog-post">
              <div class="post-header">
                <div>
                  ${categoryLabel}
                  <h2 class="post-title">${escapeHtml(post.title)}</h2>
                  <p class="post-date">${formatDate(post.timestamp)}</p>
                </div>
              </div>
              ${imageHtml}
              <div class="post-content">${parseMarkdown(escapeHtml(post.content))}</div>
              <div class="post-actions">
                <button class="edit-btn" onclick="editPost('${post.id}')">Edit</button>
                <button class="delete-btn" onclick="deletePost('${post.id}')">Delete</button>
              </div>
            </article>
          `;
        }).join('') + '</div>';
      } catch (err) {
        console.error('Error loading posts:', err);
        container.innerHTML = '<div class="empty-state"><p>Error loading posts. Please refresh the page.</p></div>';
      }
    }

    function handleSubmit(event) {
      event.preventDefault();
      
      const title = document.getElementById('postTitle').value.trim();
      const content = document.getElementById('postContent').value.trim();
      const category = document.getElementById('postCategory').value;
      const imageUrl = document.getElementById('postImageUrl').value.trim();
      const postId = document.getElementById('postId').value || `post_${Date.now()}`;
      
      if (!title || !content) {
        alert('Please fill in all required fields');
        return;
      }

      const posts = getPostsFromLocalStorage();
      const existingIndex = posts.findIndex(p => p.id === postId);
      
      const post = {
        id: postId,
        title,
        content,
        category,
        imageUrl,
        timestamp: existingIndex >= 0 ? posts[existingIndex].timestamp : Date.now()
      };

      if (existingIndex >= 0) {
        posts[existingIndex] = post;
      } else {
        posts.push(post);
      }

      savePostsToLocalStorage(posts);
      
      document.getElementById('postForm').reset();
      document.getElementById('postId').value = '';
      document.getElementById('imagePreviewContainer').classList.remove('active');
      editingPostId = null;
      document.getElementById('adminPanel').classList.remove('active');
      
      loadPosts();
      
      alert('Post published successfully! Remember to export to JSON and commit to GitHub.');
    }

    function editPost(postId) {
      const posts = getPostsFromLocalStorage();
      const post = posts.find(p => p.id === postId);
      
      if (!post) {
        alert('Post not found');
        return;
      }
      
      document.getElementById('postId').value = post.id;
      document.getElementById('postTitle').value = post.title;
      document.getElementById('postContent').value = post.content;
      document.getElementById('postCategory').value = post.category || '';
      document.getElementById('postImageUrl').value = post.imageUrl || '';
      
      previewImage();
      
      editingPostId = post.id;
      
      document.getElementById('adminPanel').classList.add('active');
      document.getElementById('postTitle').focus();
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deletePost(postId) {
      if (!confirm('Are you sure you want to delete this post? This cannot be undone.')) {
        return;
      }

      const posts = getPostsFromLocalStorage();
      const filtered = posts.filter(p => p.id !== postId);
      savePostsToLocalStorage(filtered);
      loadPosts();
      alert('Post deleted successfully! Remember to export to JSON and commit to GitHub.');
    }

    function exportPosts() {
      const posts = getPostsFromLocalStorage();
      const dataStr = JSON.stringify(posts, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'blog-posts.json';
      a.click();
      URL.revokeObjectURL(url);
      alert('Posts exported! Add blog-posts.json to your repository root.');
    }

    function cancelEdit() {
      document.getElementById('postForm').reset();
      document.getElementById('postId').value = '';
      document.getElementById('imagePreviewContainer').classList.remove('active');
      editingPostId = null;
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return date.toLocaleDateString('en-US', options);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', loadPosts);
  </script>
</body>
</html>